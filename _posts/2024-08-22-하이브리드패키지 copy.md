---
layout: post
title: ESMê³¼ CommonJSë¥¼ ìœ„í•œ í•˜ì´ë¸Œë¦¬ë“œ NPM íŒ¨í‚¤ì§€ ë§Œë“œëŠ”ë²•
date: 2024-08-22 00:00:00 +0900
description: ESMê³¼ CommonJSë¥¼ ìœ„í•œ í•˜ì´ë¸Œë¦¬ë“œ NPM íŒ¨í‚¤ì§€ ë§Œë“œëŠ”ë²•
img: 2024-08-22/hybrid_npm.png
tags: [ ESM, CommonJS, npm, Hybrid package, í•˜ì´ë¸Œë¦¬ë“œ íŒ¨í‚¤ì§€ ]
---



## ESMê³¼ CommonJSë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë” ì‰½ê²Œ ê°œë°œí•˜ê¸°

Webpack ê°™ì€ ë²ˆë“¤ëŸ¬ ì—†ì´, **ë‹¨ì¼ ì½”ë“œë² ì´ìŠ¤ë¡œ ESMê³¼ CommonJSë¥¼ ë™ì‹œì— ì§€ì›í•˜ëŠ” NPM ëª¨ë“ˆ**ì„ ì†ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆì„ê¹Œìš”?

ì´ ë¬¸ì œëŠ” ì˜¤ë«ë™ì•ˆ ë§ì€ ê°œë°œìë“¤ì˜ ê³ ë¯¼ê±°ë¦¬ì˜€ìŠµë‹ˆë‹¤.

í•˜ë‚˜ì˜ ì½”ë“œë² ì´ìŠ¤ë¡œ ESMê³¼ CommonJS í™˜ê²½ ëª¨ë‘ì—ì„œ ë™ì‘í•˜ëŠ” ëª¨ë“ˆì„ ë§Œë“œëŠ” ì¼ì€ ìƒê°ë³´ë‹¤ ì‰½ì§€ ì•ŠìŠµë‹ˆë‹¤. í”íˆ "**í•˜ì´ë¸Œë¦¬ë“œ íŒ¨í‚¤ì§€**"ë¼ê³  ë¶€ë¥´ëŠ” ì´ ë°©ì‹ì€ `import`ë‚˜ `require`ë¡œ ê°„ë‹¨íˆ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆëŠ” ëª¨ë“ˆì„ ëª©í‘œë¡œ í•˜ì§€ë§Œ, ì‹¤ì œ êµ¬í˜„ì€ ê½¤ë‚˜ ê¹Œë‹¤ë¡­ìŠµë‹ˆë‹¤.

ì´ ì£¼ì œì— ëŒ€í•œ ë¸”ë¡œê·¸ ê¸€, Stack Overflow ì§ˆë¬¸, ê³µì‹ ë¬¸ì„œê°€ ìˆ˜ë„ ì—†ì´ ë§ì§€ë§Œ â€”
ì§ì ‘ ì‹œë„í•´ë³´ë©´ ì¼ë¶€ëŠ” ì‘ë™í•˜ê³ , ì¼ë¶€ëŠ” ë¶ˆì•ˆì •í•˜ê±°ë‚˜ ì™„ì „íˆ ì‹¤íŒ¨í•˜ê¸° ì¼ì‘¤ì…ë‹ˆë‹¤.

ëŒ€ë¶€ë¶„ì˜ í•´ê²°ì±…ì€ [Webpack](https://webpack.js.org/), [Rollup](https://rollupjs.org/introduction/), ì»¤ìŠ¤í…€ ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸, í˜¹ì€ **ì´ì¤‘ ì½”ë“œë² ì´ìŠ¤**ë¥¼ ìš”êµ¬í•©ë‹ˆë‹¤.
í•˜ì§€ë§Œ ì´ëŸ° ë°©ì‹ì€ ë¹„íš¨ìœ¨ì ì´ê³ , ìˆœìˆ˜í•œ ESM ì½”ë“œë¥¼ ì œëŒ€ë¡œ ë§Œë“¤ì–´ë‚´ì§€ ëª»í•˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.

Node.js ë¬¸ì„œë¥¼ ë³´ë©´ Webpack, Rollup, ESM, CommonJS, UMD, AMD ë“± ë‹¤ì–‘í•œ ëª¨ë“ˆ ì‹œìŠ¤í…œ ì´ì•¼ê¸°ê°€ ë“±ì¥í•˜ì£ .
`.mjs`, `.cjs` í™•ì¥ìê°€ í•´ê²°ì±…ì´ë¼ê³  í•˜ì§€ë§Œ, ì†”ì§íˆ ëŒ€ë¶€ë¶„ì˜ ê°œë°œìë“¤ì€ ì´ í™•ì¥ìë“¤ì„ ë³„ë¡œ ì¢‹ì•„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ë˜í•œ `package.json`ì˜ `type = "module"`ê³¼ `exports` í‚¤ì›Œë“œê°€ ëª¨ë“  ë¬¸ì œë¥¼ í•´ê²°í•´ì¤„ ê²ƒì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, ì‹¤ì œë¡œëŠ” ê·¸ë ‡ê²Œ ë§¤ë„ëŸ½ê²Œ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

## í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“ˆ, ì´ì œ ì–´ë µì§€ ì•ŠìŠµë‹ˆë‹¤!

ì €ë„ `.mjs`, `.cjs` í™•ì¥ìë¥¼ ë¹„ë¡¯í•´ Webpack, Rollup, ê·¸ë¦¬ê³  `type` í•„ë“œ ì„¤ì •ê¹Œì§€ ë‹¤ì–‘í•œ ì‹œë„ë¥¼ í•´ë´¤ìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ ì¡°í•©ì— ë”°ë¼ ë§¤ë²ˆ ì˜ˆìƒì¹˜ ëª»í•œ ë¬¸ì œë“¤ì´ ìƒê²¼ìŠµë‹ˆë‹¤.

ê²°êµ­, ì €ëŠ” **ë‹¨ì¼ ì½”ë“œë² ì´ìŠ¤ë¡œ ì‘ë™í•˜ë©´ì„œë„ ESMê³¼ CommonJS ëª¨ë‘ì—ì„œ ì•ˆì •ì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ê°„ë‹¨í•œ ì†”ë£¨ì…˜**ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.
ì´ ë°©ì‹ì€ ìˆœìˆ˜í•œ ESM ì½”ë“œë¥¼ ìƒì„±í•˜ê³ , Webpack, ì„œë²„ë¦¬ìŠ¤ í™˜ê²½, CLI ë„êµ¬ ë“± ëŒ€ë¶€ë¶„ì˜ ìƒí™©ì—ì„œ ë¬¸ì œì—†ì´ ì‘ë™í•©ë‹ˆë‹¤.

ë¬¼ë¡  ëª¨ë“  ê²½ìš°ì— 100% ì™„ë²½í•˜ë‹¤ê³ ëŠ” í•  ìˆ˜ ì—†ì§€ë§Œ, ì¼ë°˜ì ì¸ ESM/CJS ì‚¬ìš© ì‹œì—ëŠ” ì¶©ë¶„íˆ ì‹¤ìš©ì ì¸ ì ‘ê·¼ì…ë‹ˆë‹¤.

## .mjsì˜ ë¬¸ì œì 

ë¨¼ì € í”íˆ ì‚¬ìš©ë˜ëŠ” ëª‡ ê°€ì§€ ì ‘ê·¼ë²•ì„ ì‚´í´ë´…ì‹œë‹¤.

Node.jsëŠ” `.mjs`ì™€ `.cjs` í™•ì¥ìë¥¼ ë„ì…í•´ íŒŒì¼ íƒ€ì…ì„ êµ¬ë¶„í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.
ì–¸ëœ» ë³´ê¸°ì—” í•©ë¦¬ì ì¸ ì„ íƒì²˜ëŸ¼ ë³´ì´ì£  â€” íŒŒì¼ í™•ì¥ìëŠ” ë³´í†µ íƒ€ì…ì„ êµ¬ë¶„í•˜ëŠ” ìš©ë„ë¡œ ì“°ì´ë‹ˆê¹Œìš”.

í•˜ì§€ë§Œ **í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“ˆ**ì„ ê°œë°œí•  ë•ŒëŠ” ìƒí™©ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.
`.mjs`ì™€ `.cjs`ë¥¼ ì‚¬ìš©í•˜ë©´ ì½”ë“œë² ì´ìŠ¤ê°€ ë¶„ë¦¬ë˜ê±°ë‚˜, ì†ŒìŠ¤ë¥¼ ë³µì‚¬í•´ í™•ì¥ìë¥¼ ë°”ê¾¸ê³  import êµ¬ë¬¸ì„ ë‹¤ì‹œ ìˆ˜ì •í•´ì•¼ í•˜ëŠ” ë²ˆê±°ë¡œì›€ì´ ìƒê¹ë‹ˆë‹¤.

ESMì—ì„œëŠ” import ì‹œ ê²½ë¡œë¥¼ ëª…ì‹œí•´ì•¼ í•˜ëŠ”ë°, `.mjs`ë¡œ ì‘ì„±ëœ ì½”ë“œë¥¼ CommonJSì—ì„œ `require`í•˜ë ¤ë©´ ì½”ë“œë¥¼ ë‹¤ì‹œ ê³ ì³ì•¼ í•˜ê³ , ê·¸ ë°˜ëŒ€ë„ ë§ˆì°¬ê°€ì§€ì…ë‹ˆë‹¤.

ê²Œë‹¤ê°€ ì•„ì§ë„ ë§ì€ ë¹Œë“œ ë„êµ¬ì™€ ë²ˆë“¤ëŸ¬ë“¤ì´ `.mjs` íŒŒì¼ì„ ì™„ì „íˆ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
ì¼ë¶€ ì›¹ ì„œë²„ëŠ” `.mjs`ë¥¼ ì˜ëª»ëœ MIME íƒ€ì…(`application/json` ë“±)ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸°ë„ í•˜ì£ .
ê²°êµ­ ì¶”ê°€ ì„¤ì •ì´ë‚˜ ë§¤í•‘, ì»¤ìŠ¤í…€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

ì´ëŸ° ì´ìœ ë¡œ `.mjs`, `.cjs`ë¥¼ ì ê·¹ ì¶”ì²œí•˜ëŠ” ì‚¬ëŒì€ ê±°ì˜ ì—†ìŠµë‹ˆë‹¤.
ë‹¤í–‰íˆ ë” ë‚˜ì€ ëŒ€ì•ˆì´ ìˆìŠµë‹ˆë‹¤ â€” ë°”ë¡œ `package.json`ì˜ `"type"` ì†ì„±ì…ë‹ˆë‹¤.

## package.jsonì˜ "type" ì†ì„± ë¬¸ì œ

Node.jsëŠ” `package.json`ì˜ `"type"` í•„ë“œë¥¼ ì´ìš©í•´ `.js` íŒŒì¼ì´ ESMì¸ì§€ CommonJSì¸ì§€ íŒë³„í•©ë‹ˆë‹¤.

* `"type": "module"` â†’ í•´ë‹¹ ë””ë ‰í† ë¦¬ì˜ ëª¨ë“  íŒŒì¼ì„ ESMìœ¼ë¡œ ì¸ì‹
* `"type": "commonjs"` â†’ í•´ë‹¹ ë””ë ‰í† ë¦¬ì˜ ëª¨ë“  íŒŒì¼ì„ CommonJSë¡œ ì¸ì‹

ì´ ê¸°ë³¸ ë™ì‘ì€ `.mjs` ë˜ëŠ” `.cjs` í™•ì¥ìë¡œ ê°œë³„ íŒŒì¼ ë‹¨ìœ„ì—ì„œ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```json
{
  "version": "1.2.3",
  "type": "module"
}
```

ì´ ë°©ì‹ì€ ë‹¨ì¼ íƒ€ì… íŒ¨í‚¤ì§€ì—ì„œëŠ” ê½¤ ì˜ ì‘ë™í•©ë‹ˆë‹¤.
í•˜ì§€ë§Œ **í•˜ì´ë¸Œë¦¬ë“œ íŒ¨í‚¤ì§€**ì²˜ëŸ¼ ESMê³¼ CommonJSë¥¼ ë™ì‹œì— ì§€ì›í•´ì•¼ í•˜ëŠ” ê²½ìš°ì—ëŠ” ê³¤ë€í•´ì§‘ë‹ˆë‹¤.

`"type"` ì†ì„±ì€ ì „ì—­ì ìœ¼ë¡œ í•˜ë‚˜ì˜ íƒ€ì…ë§Œ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë©°, ì¡°ê±´ë¶€ ì„¤ì •ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
ì¦‰, ESMì¼ ë• `"module"`, CJSì¼ ë• `"commonjs"`ë¡œ ìë™ ì „í™˜í•˜ëŠ” ë°©ë²•ì´ ì—†ìŠµë‹ˆë‹¤.

Node.jsì˜ `"exports"` ì¡°ê±´ë¶€ ì†ì„±ìœ¼ë¡œ ì§„ì…ì ì„ êµ¬ë¶„í•  ìˆ˜ëŠ” ìˆì§€ë§Œ, `"type"` ì†ì„±ê¹Œì§€ ì¬ì •ì˜í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.
ë‘ ì†ì„±ì€ ì œëŒ€ë¡œ ê²°í•©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

## ì¡°ê±´ë¶€ exportsì˜ í•œê³„

`exports` ì†ì„±ì€ í™˜ê²½ë³„ë¡œ ë‹¤ë¥¸ ì§„ì…ì ì„ ì •ì˜í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´, ESMì—ì„œëŠ” `import`, CommonJSì—ì„œëŠ” `require`ë¥¼ ê°ê° ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```json
{
  "exports": {
    "import": "./dist/mjs/index.js",
    "require": "./dist/cjs/index.js"
  }
}
```

ì´ë ‡ê²Œ í•˜ë©´ Node.jsëŠ” ìƒí™©ì— ë§ëŠ” ì§„ì…ì ì„ ìë™ìœ¼ë¡œ ë¡œë“œí•©ë‹ˆë‹¤.
í•˜ì§€ë§Œ íŒ¨í‚¤ì§€ì˜ `"type"`ì´ `"module"`ë¡œ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ ë¬¸ì œê°€ ìƒê¹ë‹ˆë‹¤.

CommonJS ì•±ì—ì„œ `require("./dist/cjs/index.js")`ë¥¼ ì‹¤í–‰í•´ë„, ë‚´ë¶€ì—ì„œ ë‹¤ì‹œ `require('./submodule.js')`ë¥¼ í˜¸ì¶œí•˜ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
ì™œëƒí•˜ë©´ `package.json`ì˜ `"type": "module"` ì„¤ì •ì´ ì „ì²´ ëª¨ë“ˆì— ì ìš©ë˜ì–´, require ì‚¬ìš©ì´ ê¸ˆì§€ë˜ê¸° ë•Œë¬¸ì´ì£ .

ì¦‰, Node.jsëŠ” `exports.require`ë¡œ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ë”ë¼ë„, í•˜ìœ„ ëª¨ë“ˆì˜ íƒ€ì…ì€ ë°”ê¾¸ì§€ ì•ŠìŠµë‹ˆë‹¤.
ì´ìƒì ìœ¼ë¡œëŠ” ì•„ë˜ì™€ ê°™ì€ í˜•íƒœë¡œ `"type"`ì„ ì§„ì…ì ë³„ë¡œ ì •ì˜í•  ìˆ˜ ìˆì–´ì•¼ í•˜ì§€ë§Œ, í˜„ì¬ëŠ” ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

```json
{
  "exports": {
    "import": {
      "path": "./dist/mjs/index.js",
      "type": "module"
    },
    "require": {
      "path": "./dist/cjs/index.js",
      "type": "commonjs"
    }
  }
}
```

ê²Œë‹¤ê°€ TypeScriptëŠ” ì•„ì§ `exports` ì†ì„±ì„ ì™„ë²½íˆ ì§€ì›í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—,
ê¸°ì¡´ì˜ `"main"`(CJS), `"module"`(ESM) í•„ë“œë¥¼ í•¨ê»˜ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.

```json
{
  "main": "dist/cjs/index.js",
  "module": "dist/mjs/index.js"
}
```

## í•´ê²°ì±… (Solution)

ì´ ëª¨ë“  ì¡°ê±´ì„ ë§Œì¡±í•˜ë ¤ë©´ ë‹¤ìŒì´ í•„ìš”í•©ë‹ˆë‹¤:

* ë‹¨ì¼ ì½”ë“œë² ì´ìŠ¤
* ê°„ë‹¨í•œ ë¹Œë“œ í”„ë¡œì„¸ìŠ¤
* ë„¤ì´í‹°ë¸Œ ESM ì½”ë“œ ìƒì„±
* íˆ´ í˜¸í™˜ì„±
* ESMê³¼ CommonJSë¥¼ ë™ì‹œì— ì§€ì›

### ë‹¨ì¼ ì½”ë“œë² ì´ìŠ¤ ìœ ì§€

ì½”ë“œëŠ” ES6+, ESNext, í˜¹ì€ TypeScriptë¡œ ì‘ì„±í•©ë‹ˆë‹¤.
ê¸°ë³¸ì ìœ¼ë¡œ `import`/`export`ë¥¼ ì‚¬ìš©í•˜ê³ , CommonJSì—ì„œëŠ” `require`ë¡œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

```typescript
import Shape from './Shape.js'

export class MyShape {
  constructor() {
    this.shape = new Shape()
  }
}
```

ë‹¨, `export default`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° CommonJSì—ì„œ ë¶ˆëŸ¬ì˜¬ ë•Œ `.default` ì°¸ì¡°ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```typescript
const Shape = require('./Shape.js')
const shape = new Shape.default()
```

### ë¹Œë“œ

ì½”ë“œë¥¼ ë‘ ë²ˆ ë¹Œë“œí•©ë‹ˆë‹¤ â€” í•œ ë²ˆì€ ESMìš©, í•œ ë²ˆì€ CJSìš©.

TypeScriptë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ë‹¤ìŒì²˜ëŸ¼ ê°„ë‹¨íˆ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```json
{
  "scripts": {
    "build": "rm -rf dist && tsc -p tsconfig.json && tsc -p tsconfig-cjs.json && ./fixup"
  }
}
```

`.js` í™•ì¥ìë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ê³ , `.mjs`ë‚˜ `.cjs`ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### tsconfig ì„¤ì • ì˜ˆì‹œ

* `tsconfig-base.json`: ê³µí†µ ì„¤ì •
* `tsconfig.json`: ESM ë¹Œë“œìš©
* `tsconfig-cjs.json`: CJS ë¹Œë“œìš©

ì´ë ‡ê²Œ í•˜ë©´ ì„¤ì • ì¤‘ë³µì„ ìµœì†Œí™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```json
// tsconfig.json
{
  "extends": "./tsconfig-base.json",
  "compilerOptions": {
    "module": "esnext",
    "outDir": "dist/mjs",
    "target": "esnext"
  }
}
```

```json
// tsconfig-cjs.json
{
  "extends": "./tsconfig-base.json",
  "compilerOptions": {
    "module": "commonjs",
    "outDir": "dist/cjs",
    "target": "es2015"
  }
}
```

### ë¹Œë“œ í›„ package.json ìë™ ìƒì„±

ë§ˆì§€ë§‰ ë‹¨ê³„ë¡œ ê° ë¹Œë“œ ê²°ê³¼ ë””ë ‰í† ë¦¬ì— `"type"`ì„ ì§€ì •í•˜ëŠ” `package.json`ì„ ìë™ ìƒì„±í•©ë‹ˆë‹¤.

```bash
cat > dist/cjs/package.json <<EOF
{
  "type": "commonjs"
}
EOF

cat > dist/mjs/package.json <<EOF
{
  "type": "module"
}
EOF
```

### ìµœì¢… package.json ì„¤ì •

ë£¨íŠ¸ `package.json`ì—ëŠ” `"type"`ì„ ì§€ì •í•˜ì§€ ì•Šê³ , ëŒ€ì‹  í•˜ìœ„ `dist/*` ë””ë ‰í† ë¦¬ì—ì„œ ì§€ì •í•©ë‹ˆë‹¤.

```json
{
  "main": "dist/cjs/index.js",
  "module": "dist/mjs/index.js",
  "exports": {
    ".": {
      "import": "./dist/mjs/index.js",
      "require": "./dist/cjs/index.js"
    }
  }
}
```

## ì •ë¦¬

ì´ ë°©ì‹ìœ¼ë¡œ ë¹Œë“œí•˜ë©´ `import`ì™€ `require` ëª¨ë‘ ìì—°ìŠ¤ëŸ½ê²Œ ë™ì‘í•˜ëŠ” **í•˜ì´ë¸Œë¦¬ë“œ íŒ¨í‚¤ì§€**ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì¦‰, ESMê³¼ CommonJS ì‚¬ìš©ì ëª¨ë‘ë¥¼ ë§Œì¡±ì‹œí‚¤ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê°„ë‹¨í•˜ê²Œ ìœ ì§€í•  ìˆ˜ ìˆì£ .

ì˜ˆì‹œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤ ğŸ‘‡

[npm: arehs](https://www.npmjs.com/package/arehs)

**CommonJS**

```javascript
const { Arehs } = require("arehs");
```

**ES Modules**

```javascript
import { Arehs } from "arehs";
```
